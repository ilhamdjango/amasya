<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sənədlər</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <!-- Custom CSS -->
    <link th:href="@{/css/document.css}" rel="stylesheet">
</head>
<body th:class="${theme}">

<div class="container py-4">

    <!-- Başlıq -->
    <div class="d-flex align-items-center mb-4">
        <h3 class="fw-bold mb-0">
            <i class="fa-solid fa-folder me-2"></i> Şəxsi sənədlər
        </h3>


        <div class="ms-auto d-flex gap-2">
            <a th:href="@{'/students/' + ${trainingId}}" class="btn btn-success">
                <i class="fa-solid fa-arrow-left me-1"></i> Geri
            </a>

            <div class="btn-group" role="group">
                <a th:href="@{'/students/documents/completed/' + ${student.id} + '/' + ${trainingId}}"
                   th:classappend="${student.documents} ? 'btn-success' : 'btn-outline-success'"
                   class="btn">
                    <i class="fa-solid fa-check me-1"></i> Tamamlandı
                </a>

                <a th:href="@{'/students/documents/notcompleted/' + ${student.id} + '/' + ${trainingId}}"
                   th:classappend="${!student.documents} ? 'btn-danger' : 'btn-outline-danger'"
                   class="btn">
                    <i class="fa-solid fa-xmark me-1"></i> Tamamlanmadı
                </a>
            </div>

        </div>
    </div>



    <!-- Şəkil Yükləmə Kartı -->
    <div class="card shadow-lg mb-4 p-4">
        <form th:action="@{/students/documents/{studentId}/{trainingId}(studentId=${student.id}, trainingId=${trainingId})}" method="post" enctype="multipart/form-data" class="row g-3 align-items-stretch">

            <div class="col-md-6 d-flex">
                <input type="text" name="documentName" class="form-control flex-grow-1" placeholder="Sənədin adını daxil edin" required>
            </div>

            <div class="col-md-6 d-flex">
                <label class="custom-file-upload w-100 flex-grow-1">
                    <input type="file" id="fileUpload" name="file" required>
                    <span id="fileName">Heç bir fayl seçilməyib</span>
                </label>
            </div>

            <div class="col-12">
                <button type="submit" class="btn btn-success w-100 mt-2">
                    <i class="fa-solid fa-plus me-1"></i> Əlavə Et
                </button>
            </div>
        </form>
    </div>

    <script>
        const fileInput = document.getElementById("fileUpload");
        const fileName = document.getElementById("fileName");
        fileInput.addEventListener("change", function () {
            fileName.textContent = this.files && this.files.length > 0 ? this.files[0].name : "Heç bir fayl seçilməyib";
        });
    </script>

    <!-- Şəkil Siyahısı Kartı -->
    <div class="card shadow-lg p-4">
        <h5 class="mb-3">Mövcud Şəkillər</h5>
        <div class="table-responsive">
            <table class="table table-striped table-bordered align-middle text-center">
                <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Şəkil</th>
                    <th>Sənəd Adı</th>
                    <th>Əməliyyatlar</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="img : ${images}">
                    <td th:text="${img.id}"></td>
                    <td>
                        <a th:href="@{'/uploads/' + ${img.fileName}}" target="_blank">
                            <img th:src="@{'/uploads/' + ${img.fileName}}" class="img-thumbnail" style="max-width: 120px;">
                        </a>
                    </td>
                    <td th:text="${img.documentName}"></td>
                    <td>
                        <a th:href="@{'/students/documents/' + ${student.id} + '/delete/' + ${img.id}}"
                           class="btn btn-danger btn-sm"
                           onclick="return confirm('Silmək istədiyinizə əminsiniz?')">
                            <i class="fa fa-trash"></i> Sil
                        </a>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(images)}">
                    <td colspan="4" class="text-muted">Hələ şəkil yüklənməyib.</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center mt-3">
                <!-- Previous -->
                <li class="page-item" th:classappend="${imagesPage.first} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/students/documents/{studentId}/{trainingId}(studentId=${student.id}, trainingId=${trainingId}, page=${imagesPage.number - 1})}">
                        <i class="fa-solid fa-chevron-left me-1"></i>
                    </a>
                </li>

                <li class="page-item disabled">
                    <a class="page-link" href="#">
                        Səhifə <span th:text="${imagesPage.number + 1}"></span> / <span th:text="${imagesPage.totalPages}"></span>
                    </a>
                </li>

                <li class="page-item" th:classappend="${imagesPage.last} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/students/documents/{studentId}/{trainingId}(studentId=${student.id}, trainingId=${trainingId}, page=${imagesPage.number + 1})}">
                        <i class="fa-solid fa-chevron-right ms-1"></i>
                    </a>
                </li>


            </ul>
        </nav>

    </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/theme.js}"></script>
</body>
</html>
